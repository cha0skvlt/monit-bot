# Руководство по проекту мониторинга веб-сайтов

Данный документ описывает работу Telegram-бота для отслеживания доступности
сайтов и срока действия SSL‑сертификатов. Инструкция рассчитана на разработчиков
и администраторов, желающих развернуть и модифицировать проект.

## Содержание

1. [Структура репозитория](#structure)
2. [Запуск через Docker](#docker)
3. [Запуск напрямую через Python](#python-run)
4. [Переменные окружения](#env)
5. [Логирование и состояние](#logging)
6. [Фоновые задачи](#background)
7. [Телеграм-команды](#commands)
8. [Тестирование](#tests)
9. [Расширение функционала](#extend)

<a name="structure"></a>
## 1. Структура репозитория

- `bot.py` – основной входной скрипт Telegram-бота. Здесь регистрируются все
  команды и запускаются фоновые потоки.
- `core.py` – функции ядра: проверка сайтов, проверка SSL, отправка
  уведомлений, работа с файлами.
- `db.sqlite` – база данных SQLite с сайтами, статусами и логами.
- `Dockerfile` и `docker-compose.yml` – файлы для контейнеризации.
- `tests/` – модульные тесты, покрывающие основные функции.
- `logs/` – каталог для журналов (создается автоматически).

<a name="docker"></a>
## 2. Запуск через Docker

1. Скопируйте файл `.env.example` в `.env` и укажите токен бота и ID чата:
   ```bash
   cp .env.example .env
   # отредактируйте .env
   ```

2. Соберите и запустите контейнер:
   ```bash
   docker compose up --build -d
   ```
    Контейнер создаст базу SQLite при первом запуске. При желании можно изменить
    путь к ней через переменную `DB_FILE`, а также настроить `LOG_FILE` и
    `REQUEST_TIMEOUT`.

<a name="python-run"></a>
## 3. Запуск напрямую через Python

Установите зависимости и запустите `bot.py`:
```bash
pip install -r requirements.txt
python bot.py
```
Бот начнет опрашивать сайты и принимать команды в Telegram и будет оставаться
активным, так как вызов `updater.idle()` блокирует основной поток. Для
долговременной работы рекомендуется использовать Docker либо иной менеджер
процессов.

<a name="env"></a>
## 4. Переменные окружения

- `BOT_TOKEN` – токен вашего Telegram-бота.
- `CHAT_ID` – идентификатор чата, куда будут отправляться уведомления.

Дополнительные переменные позволяют настроить приложение:

- `DB_FILE` – путь к базе SQLite (по умолчанию `/app/db.sqlite`). Если указать
  каталог, файл `db.sqlite` будет создан внутри него.
- `LOG_FILE` – файл журнала событий (по умолчанию `/app/logs/monitor.log`).
- `REQUEST_TIMEOUT` – таймаут HTTP-запросов в секундах (по умолчанию `10`).

Все переменные загружаются через `dotenv`. `BOT_TOKEN` и `CHAT_ID` обязательны,
остальные имеют значения по умолчанию.

<a name="logging"></a>
## 5. Логирование и состояние

Все события сохраняются в базу SQLite и дублируются в файл `logs/monitor.log`
(переменная `LOG_FILE`). Так журналы можно легко отправлять в Grafana Loki или
ELK.

Телеграм-бот для мониторинга сайтов и проверки SSL. Работает в Docker и сохраняет данные в SQLite.

## Структура

- `bot.py` — команды и запуск
- `core.py` — проверки и работа с БД
- `Dockerfile` и `docker-compose.yml` — контейнеры
- `start.sh` — вспомогательный скрипт

## Запуск через Docker

1. Скопируйте `.env.example` в `.env` и укажите `BOT_TOKEN`, `CHAT_ID`, `ADMIN_IDS` и `OWNER_ID`.
2. Запустите:

```bash
docker compose up --build -d
```

База данных создастся автоматически. Переменные `DB_FILE`, `LOG_FILE` и `REQUEST_TIMEOUT` позволяют настроить пути и таймауты.

## Запуск без Docker

```bash
pip install -r requirements.txt
python bot.py
```

## Переменные окружения

- `BOT_TOKEN`, `CHAT_ID` — обязательны
- `ADMIN_IDS` — список админов
- `OWNER_ID` — может управлять админами
- `DB_FILE` — путь к базе
- `LOG_FILE` — файл логов
- `REQUEST_TIMEOUT` — таймаут запросов

## Команды

- `/add <url>` — добавить сайт
- `/rem <url>` — удалить сайт
- `/status` — статус сайтов
- `/checkssl` — проверить SSL
- `/list` — список сайтов
- `/add_admin <id>` — выдать права
- `/rm_admin <id>` — отозвать права
- `/help` — справка

## Фоновые задачи

Бот каждую минуту опрашивает сайты и раз в день проверяет SSL. При сбоях отправляет уведомления и пишет события в базу и лог-файл.


**Версия: 2.0**
